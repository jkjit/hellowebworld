node {
  stage('SCM Checkout') {
        git branch: 'qabranch', url:'https://github.com/jkjit/hellowebworld.git'
        }
   stage('Compile Project'){
     //Get MAVEN HOME PATH
     def mvnHome = tool name: 'mymvn3', type: 'maven'
     sh "${mvnHome}/bin/mvn clean package"
       }
  stage('Docker build'){
    //Building docker image from git
    sh "docker build -t jkckdocker/hellowebworld:latest -t jkckdocker/hellowebworld:${currentBuild.number} ."
  }
  stage('Docker Push'){
  
      environment {
         registry = "jkckdocker/helloworld"
         registryCredentials = "DOCKER_USER_PWD"
      }
  withCredentials([usernameColonPassword(credentialsId: 'DOCKER_USER_PWD', variable: 'DOCKER_CREDENTIALS')]) {

 sh """
      docker push jkckdocker/hellowebworld:${currentBuild.number}
      docker push jkckdocker/hellowebworld:latest
      
    """ 
}  
   
}   
  }
  stage('Clean up'){
    sh """
      docker rmi jkckdocker/hellowebworld:${currentBuild.number}
      docker rmi jkckdocker/hellowebworld:latest
      """
  }

}
