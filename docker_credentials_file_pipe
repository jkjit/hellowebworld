node {
  stage('SCM Checkout') {
    // Checking out from GIT server at particular branch
        git branch: 'qabranch', url:'https://github.com/jkjit/hellowebworld.git'
        }
   stage('Compile Project'){
     //Get MAVEN HOME PATH
     def mvnHome = tool name: 'mymvn3', type: 'maven'
     sh "${mvnHome}/bin/mvn clean package"
       }
  stage('Docker build'){
    //Building docker image from git
    sh "docker build -t jkckdocker/hellowebworld:latest -t jkckdocker/hellowebworld:${currentBuild.number} ."
  }
  stage('Docker Push'){ 
    // Logging to Docker hub with user name and password with jenkins global configured values
    withCredentials([usernameColonPassword(credentialsId: 'DOCKER_USER_PWD', variable: 'DOCKER_CREDENTIALS')]) {
    // pushing docker images to docker hub
     sh """
          docker push jkckdocker/hellowebworld:${currentBuild.number}
          docker push jkckdocker/hellowebworld:latest
        """ 
      }  
   
    }   
  stage('Clean up'){
  // clearing docker images created inside jenkins server to save space
    sh """
      docker rmi jkckdocker/hellowebworld:${currentBuild.number}
      docker rmi jkckdocker/hellowebworld:latest
      """
  }
}
